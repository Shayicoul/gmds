
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../user-guide/singgraphbuild/">
      
      
        <link rel="next" href="../unit_test/">
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.6">
    
    
      
        <title>How to develop a gmds module - GMDS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#developer-documentation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="GMDS" class="md-header__button md-logo" aria-label="GMDS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GMDS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              How to develop a gmds module
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/LIHPC-Computational-Geometry/gmds" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gmds/gmds
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="GMDS" class="md-nav__button md-logo" aria-label="GMDS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    GMDS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/LIHPC-Computational-Geometry/gmds" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gmds/gmds
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" tabindex="0" aria-expanded="false">
          User Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="User Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          User Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/users_doc/" class="md-nav__link">
        How to use gmds
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" tabindex="0" aria-expanded="false">
          Core modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Core modules" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Core modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/cad/" class="md-nav__link">
        cad 
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/cadfac/" class="md-nav__link">
        cadfac 
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/ig/" class="md-nav__link">
        ig
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/igalgo/" class="md-nav__link">
        igalgo 
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/io/" class="md-nav__link">
        io 
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/quality/" class="md-nav__link">
        quality 
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/math/" class="md-nav__link">
        math 
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/smoothy/" class="md-nav__link">
        smoothy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/utils/" class="md-nav__link">
        utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" tabindex="0" aria-expanded="false">
          Optional modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Optional modules" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Optional modules
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/blocking/" class="md-nav__link">
        Blocking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/elg3d/" class="md-nav__link">
        Elg3D
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/elgmorphing.md" class="md-nav__link">
        elgmorphing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/frame/" class="md-nav__link">
        Frame
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/frame3d/" class="md-nav__link">
        Frame3d
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/geodhoneycomb/" class="md-nav__link">
        GeodHoneyComb
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/hybridmeshadapt/" class="md-nav__link">
        HybridMeshAdapt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/kmds/" class="md-nav__link">
        kmds
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/padding/" class="md-nav__link">
        padding
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/polyblock/" class="md-nav__link">
        polyblock
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/sheet/" class="md-nav__link">
        sheet
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/singgraphbuild/" class="md-nav__link">
        SingGraphBuild
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" tabindex="0" aria-expanded="true">
          Developer Guide
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developer Guide" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Developer Guide
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          How to develop a gmds module
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        How to develop a gmds module
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-your-development-environment" class="md-nav__link">
    Setting your development environment
  </a>
  
    <nav class="md-nav" aria-label="Setting your development environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#raw-installation-of-dependencies-with-spack" class="md-nav__link">
    Raw installation of dependencies with spack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-of-specific-spack-recipes" class="md-nav__link">
    Usage of specific spack recipes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creation-of-an-optional-module" class="md-nav__link">
    Creation of an optional module
  </a>
  
    <nav class="md-nav" aria-label="Creation of an optional module">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-writeupdate-a-cmakeliststxt-file-for-a-module" class="md-nav__link">
    How to write/update a CMakeLists.txt file for a module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-create-a-new-module" class="md-nav__link">
    How to create a new module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-create-an-executable-in-a-gmds-module" class="md-nav__link">
    How to create an executable in a GMDS module
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../unit_test/" class="md-nav__link">
        Test-driven development
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" tabindex="0" aria-expanded="false">
          About
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../license.md" class="md-nav__link">
        License
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../release-notes.md" class="md-nav__link">
        Release Notes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setting-your-development-environment" class="md-nav__link">
    Setting your development environment
  </a>
  
    <nav class="md-nav" aria-label="Setting your development environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#raw-installation-of-dependencies-with-spack" class="md-nav__link">
    Raw installation of dependencies with spack
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#usage-of-specific-spack-recipes" class="md-nav__link">
    Usage of specific spack recipes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creation-of-an-optional-module" class="md-nav__link">
    Creation of an optional module
  </a>
  
    <nav class="md-nav" aria-label="Creation of an optional module">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#how-to-writeupdate-a-cmakeliststxt-file-for-a-module" class="md-nav__link">
    How to write/update a CMakeLists.txt file for a module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-create-a-new-module" class="md-nav__link">
    How to create a new module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-to-create-an-executable-in-a-gmds-module" class="md-nav__link">
    How to create an executable in a GMDS module
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  



<h1 id="developer-documentation">Developer documentation</h1>
<h2 id="setting-your-development-environment">Setting your development environment</h2>
<p>gmds depends on many external components. In order to develop gmds, they need to be installed properly in
order to be used with CMake.</p>
<p>On linux systems, and macos, we suggest to use <a href="https://spack.io/">spack</a> for installing your depencies. 
We use this system for our CI workflows. In a nutshell, spack allows you to install a set of libraries in a 
specific directory. You can see it as an equivalent of <em>Python environment</em>. In our context,
we will simply install the set of dependencies we need and use them in our CMake build system. As an example,
let's take a look how to install the basic set of gmds components, plus the blocking component with the Python API and 
without CGNS dependency.</p>
<h3 id="raw-installation-of-dependencies-with-spack">Raw installation of dependencies with spack</h3>
<p>First of all, we download spack and change its way of installing libraries (second line with the <code>sed</code> command).
After that, any library <code>toto</code> installed with spack will be located in  <code>absolute_path/spack/opt/spack/toto/</code>.</p>
<pre><code class="language-bash">git clone --depth=1 -b releases/latest https://github.com/spack/spack.git
sed -i 's#&quot;${ARCHITECTURE}/${COMPILERNAME}-${COMPILERVER}/${PACKAGE}-${VERSION}-${HASH}&quot;#&quot;${PACKAGE}&quot;#g' spack/etc/spack/defaults/config.yaml
. ./spack/share/spack/setup-env.sh
</code></pre>
<p>Now, we can install the different packages that are required by <em>gmds</em>. There are many ways of doing it. 
We use here the most basic one, that consists in successively asking spack to install all the
required dependencies. Here:
- <code>lcov</code> is used to perform code coverage locally to your computer;
- <code>py-pybind11</code> is mandatory for the python API;
- <code>glpk</code> is a linear programming solver that we used in some of our <em>gmds</em> basic components;
- <code>googletest</code> is used for our testing infrastructure;
- <code>cgal</code> is required for the blocking component.</p>
<pre><code class="language-bash">spack external find cmake
spack install lcov
spack install py-pybind11
spack install glpk
spack install googletest
spack install cgal
spack install --only dependencies gmds+kmds+blocking ^kokkos+openmp ^cgns~mpi
</code></pre>
<p>Once all those libraries installed, <em>gmds</em> can be compiled with CMake using the following options</p>
<pre><code class="language-cmake">-DWITH_PYTHON_API=ON
-DENABLE_BLOCKING=ON
-DWITH_CGNS=OFF
-DWITH_TEST=ON
-DGLPK_INC=/absolute_path/spack/opt/spack/glpk/include
-DGLPK_LIB=/absolute_path/spack/opt/spack/glpk/lib
-DCMAKE_PREFIX_PATH=/absolute_path/spack/opt/spack/googletest;/absolute_path/spack/opt/spack/py-pybind11;/absolute_path/spack/opt/spack/cgal;/absolute_path/spack/opt/spack/gmp;/absolute_path/spack/opt/spack/mpfr;/absolute_path/spack/opt/spack/boost
</code></pre>
<h3 id="usage-of-specific-spack-recipes">Usage of specific spack recipes</h3>
<p>Instead of manually and individually installing all the <em>gmds</em> dependencies, we can gather <em>gmds</em> requirements
into a <em>spack recipe</em>. This recipe will be used by the spack engine to prepare and build the full environment. </p>
<p>Our meshing recipes are stored in a github repository that you have to clone and add in the list of spack repositories.</p>
<pre><code class="language-bash">git clone --branch gmds_temp --depth=1 https://github.com/LIHPC-Computational-Geometry/spack_recipes_meshing.git
spack repo add ./spack_recipes_meshing/meshing_repo
spack repo add ./spack_recipes_meshing/supersede_repo
</code></pre>
<p>Then you can install the gmds dependencies using lines like:</p>
<pre><code class="language-bash">spack external find cmake
spack install py-pybind11
spack install --only dependencies gmds+blocking 
</code></pre>
<p>Right now, the python binding configuration, as well as the CGNS options, are not managed in the gmds spack recipe. That's
why, we separately install <code>pybind11</code> and the last line will install <code>cgns</code> too.</p>
<h2 id="creation-of-an-optional-module">Creation of an optional module</h2>
<p>Once a component created, we use a <a href="git_workflow.md">github workflow</a> in order to structure the code development.
We also intensively use <a href="unit_testing.md">unit tests</a> to valid our codes and also to perform code coverage when we merge developments.</p>
<p>The creation of a new GMDS component requires to follow the guideline given below.</p>
<h3 id="how-to-writeupdate-a-cmakeliststxt-file-for-a-module">How to write/update a CMakeLists.txt file for a module</h3>
<p>Be careful, each time you add a new header file in the <strong>inc</strong> subdirectory or a source file in the <em><em>src</em> subdirectory, a reference to this file must be added in the </em>CMakeLists.txt* file.</p>
<h3 id="how-to-create-a-new-module">How to create a new module</h3>
<p>GMDS is structured as a set of libraries, each library being defined in a module. We follow the strict rule of "one module gives one library". In order to define a new module, and so library you have to follow the next series of actions. Let us consider that we want to define a new module named <em>xxx</em></p>
<ol>
<li>
<p>At the root directory of <strong>gmds</strong>, add a directory, named by your module name (always start with a small letter). Let us call it <strong>xxx</strong>;</p>
</li>
<li>
<p>At the root directory of <strong>gmds</strong>, open the file <em>CMakeLists.txt</em> and add the following command in the section entitle <em>OPTIONAL COMPONENTS</em></p>
</li>
</ol>
<pre><code class="language-cmake">GMDS_ADD_COMPONENT(
        XXX                               # cmake variable
        xxx                               # src subdirectory name
        GMDSXxx                           # name of the generated library
        &quot;description of the component&quot;  # description
        ON                                  # is activated
        ON                                 # must be covered
)
</code></pre>
<p><strong>GMDS_ADD_COMPONENT</strong> is a CMake macro for GMDS.
- The first parameter of the macro is the CMake variable that will be used for this component.
- The source code of the component must be in the subdirectory given as the second parameter.
- The third parameter is the name given at the component library when it will be installed. In the project and everywhere in another "CMakeLists.txt" file, the library will be accessible via the marco <em>${LIB_GMDS_XXX}$</em>
- The fourth parameter is a Boolean flag indicating that the component must be built (ON) or not (OFF)
- The fifth parameter is also a Boolean flag used to know if the module must be covered by the code coverage procedure that we use when a "push"-like command is performed.</p>
<ol>
<li>
<p>Get into the <strong>xxx</strong> subdirectory and create 3 subdirectories named <strong>inc</strong>, <strong>src</strong> and <strong>tst</strong> and a <em>CMakeLists.txt</em> file. In the <strong>inc</strong> subdirectory create a subdirectory <strong>gmds</strong> that includes subdirectory <strong>xxx* to achieve the following structure </strong>xxx/inc/gmds/xxx/**</p>
</li>
<li>
<p>Fill the *CMakeLists.txt" file as follows:</p>
</li>
</ol>
<pre><code class="language-cmake">
#==============================================================================
# LIBRARY DEFINTION (SOURCE FILES)
#==============================================================================
# Explicity used the name given in this preamble
set(GMDS_LIB ${LIB_GMDS_XXX})
set(GMDS_LIB_PREFIX gmds/xxx)

set(GMDS_INC
        inc/gmds/xxx/Class1.h
        inc/gmds/xxx/Class2.h
        )
set(GMDS_SRC
        src/Class1.cpp
        src/Class2.cpp
        )
#==============================================================================
add_library(${GMDS_LIB} ${GMDS_INC} ${GMDS_SRC})
#==============================================================================
# TARGET DEFINITION
#==============================================================================
include(GNUInstallDirs)
#LIBRARY TO INSTALL
target_link_libraries(${GMDS_LIB} PUBLIC
        ${LIB_GMDS_CAD}
        ${LIB_GMDS_IG})

#==============================================================================
# NOTHING TO UPDATE BELOW
#==============================================================================

target_compile_features(${GMDS_LIB} PUBLIC cxx_std_14)

# INCLUDE TO INSTALL
target_include_directories(${GMDS_LIB} PUBLIC
        $&lt;BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/inc&gt;
        $&lt;INSTALL_INTERFACE:${CMAKE_INSTALL_PREFIX}/include&gt;
        )
set_target_properties(${GMDS_LIB} PROPERTIES PUBLIC_HEADER &quot;${GMDS_INC}&quot;)

install(TARGETS ${GMDS_LIB}
        EXPORT GMDS_SUITE
        PUBLIC_HEADER DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/${GMDS_LIB_PREFIX}
        LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}/cmake/gmds
        ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}/cmake/gmds)

#==============================================================================
if(WITH_TEST)
#    add_subdirectory(tst)
endif(WITH_TEST)
#==============================================================================
</code></pre>
<p>This file deserves a few comments:
- You must set the two first variable using the name of your component (XXX) and the name of the subdirectory (xxx).
- Each time you create a new class, the corresponding header and src files must be added to the lists <em>GMDS_INC</em> and <em>GMDS_SRC</em> respectively.
- Note that the <em>inc</em> subidrectory is always structured with two subdirectories, i.e. <em>inc/gmds/xxx/</em> for getting a homogeneous way of accessing to gmds header files.
- The command <strong>target_link_libraries(${GMDS_LIB} PUBLIC ....)</strong> is very important. It is where you give the dependency of your module to other GDMS module or to external libraries.
- The remainder of the CMakefiles.txt should not be edited. It is used to generate libraries and to define the install procedure</p>
<h3 id="how-to-create-an-executable-in-a-gmds-module">How to create an executable in a GMDS module</h3>
<p>A GMDS module is associated to a library. But sometimes, for debug and test reasons, we can generate an executable. Considering the module <em>XXX</em>, you can do it by adding the next lines in the *CMakeLists.txt" file. </p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.51d95adb.min.js"></script>
      
        <script src="../../search/main.js"></script>
      
    
  </body>
</html>